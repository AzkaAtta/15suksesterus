---
/**
 * SiteMeta.astro — Meta tag lengkap (SEO + Social)
 * Pakai di slot <head> tiap halaman.
 */

interface HrefLang {
  href: string;       // absolute URL
  hreflang: string;   // e.g. "id", "en", "x-default"
}

interface Props {
  // Dasar
  title?: string;
  description?: string;
  keywords?: string[] | string;
  author?: string;

  // URL
  url?: string;                 // absolute URL halaman (canonical)
  siteName?: string;            // nama situs/brand
  canonical?: string;           // override canonical (optional)
  noindex?: boolean;            // true = noindex,nofollow

  // Open Graph / Twitter
  image?: string;               // absolute preferred; bisa relative
  imageAlt?: string;
  imageWidth?: number;
  imageHeight?: number;
  ogType?: 'website' | 'article' | 'product' | 'profile';
  twitterCard?: 'summary_large_image' | 'summary';
  twitterSite?: string;         // @username
  twitterCreator?: string;      // @username

  // Article (optional, jika ogType='article')
  articlePublishedTime?: string; // ISO datetime
  articleModifiedTime?: string;  // ISO datetime
  articleAuthor?: string | string[];
  articleSection?: string;       // kategori
  articleTags?: string[];        // tags

  // Locale & hreflang
  locale?: string;              // e.g. "id_ID"
  alternateLocales?: string[];  // e.g. ["en_US"]
  hrefLangs?: HrefLang[];       // hreflang links

  // Misc
  themeColor?: string;          // e.g. "#ffffff"
}

const {
  title = 'Aura Digital',
  description = 'Jasa sosial media & digital marketing yang aman dan terpercaya.',
  keywords = [],
  author = 'Aura Digital',

  url = 'https://auradigital.id/',
  siteName = 'Aura Digital',
  canonical,

  noindex = false,

  image = '/og-home.png',
  imageAlt = 'Aura Digital — Layanan Sosial Media',
  imageWidth = 1200,
  imageHeight = 630,
  ogType = 'website',
  twitterCard = 'summary_large_image',
  twitterSite = '@auradigitalid',
  twitterCreator = '@auradigitalid',

  articlePublishedTime,
  articleModifiedTime,
  articleAuthor,
  articleSection,
  articleTags = [],

  locale = 'id_ID',
  alternateLocales = [],
  hrefLangs = [],

  themeColor = '#ffffff',
}: Props = Astro.props

// Helpers
const siteOrigin = Astro.site?.href?.replace(/\/$/, '') || '';
const ensureAbs = (src: string) =>
  src.startsWith('http://') || src.startsWith('https://')
    ? src
    : `${siteOrigin}${src.startsWith('/') ? '' : '/'}${src}`;

const pageUrl = (canonical || url).replace(/\/?$/, '/'); // pastikan trailing slash
const ogImage = ensureAbs(image);
const kw = Array.isArray(keywords) ? keywords.join(', ') : keywords;
---

<!-- Primary -->
<title>{title}</title>
<meta name="title" content={title} />
<meta name="description" content={description} />
{kw && <meta name="keywords" content={kw} />}
<meta name="author" content={author} />
<meta name="robots" content={noindex ? 'noindex, nofollow' : 'index, follow'} />
<link rel="canonical" href={pageUrl} />

<!-- Hreflang (opsional) -->
{hrefLangs.map((a) => (
  <link rel="alternate" hreflang={a.hreflang} href={a.href} />
))}
{hrefLangs.length === 0 && (
  <link rel="alternate" hreflang="x-default" href={pageUrl} />
)}

<!-- Open Graph -->
<meta property="og:title" content={title} />
<meta property="og:description" content={description} />
<meta property="og:type" content={ogType} />
<meta property="og:url" content={pageUrl} />
<meta property="og:site_name" content={siteName} />
<meta property="og:locale" content={locale} />
{alternateLocales.map((l) => (
  <meta property="og:locale:alternate" content={l} />
))}
<meta property="og:image" content={ogImage} />
<meta property="og:image:secure_url" content={ogImage} />
<meta property="og:image:alt" content={imageAlt} />
<meta property="og:image:width" content={String(imageWidth)} />
<meta property="og:image:height" content={String(imageHeight)} />

<!-- Twitter -->
<meta name="twitter:card" content={twitterCard} />
<meta name="twitter:site" content={twitterSite} />
<meta name="twitter:creator" content={twitterCreator} />
<meta name="twitter:title" content={title} />
<meta name="twitter:description" content={description} />
<meta name="twitter:image" content={ogImage} />

<!-- Article (opsional) -->
{ogType === 'article' && articlePublishedTime && (
  <meta property="article:published_time" content={articlePublishedTime} />
)}
{ogType === 'article' && articleModifiedTime && (
  <meta property="article:modified_time" content={articleModifiedTime} />
)}
{ogType === 'article' && articleAuthor && (
  Array.isArray(articleAuthor)
    ? articleAuthor.map((a) => <meta property="article:author" content={a} />)
    : <meta property="article:author" content={articleAuthor} />
)}
{ogType === 'article' && articleSection && (
  <meta property="article:section" content={articleSection} />
)}
{ogType === 'article' && articleTags.map((t) => (
  <meta property="article:tag" content={t} />
))}

<!-- PWA / Theming (opsional, aman dibiarkan) -->
<meta name="theme-color" content={themeColor} />
<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
<link rel="apple-touch-icon" href="/apple-touch-icon.png" />
